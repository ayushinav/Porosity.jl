@testitem "forward tests" tags=[:forward] begin
    using BenchmarkTools
    h = [100.0, 1000.0] # m
    ρ = log10.([100.0, 10.0, 1000.0]) # Ωm
    m = MTModel(ρ, h)
    T = 10 .^ (range(-3, 5; length=57))
    ω = 2π ./ T
    nω = length(T)
    resp = forward(m, ω)

    # @show @ballocated forward!(resp, m, ω)

    Z_tst = [
        (0.3933382406337992 + 0.7107973536471329 * im),
        (0.2896547948583126 + 0.5667129299244454 * im),
        (0.21676479964533685 + 0.44600725380463363 * im),
        (0.16567286028193368 + 0.3484710061720278 * im),
        (0.12939893955019327 + 0.27144037144774946 * im),
        (0.10306309508709802 + 0.21142536444131635 * im),
        (0.0834292632224104 + 0.16500729075662524 * im),
        (0.06839979658201216 + 0.12921664539037486 * im),
        (0.05661497845455163 + 0.10162747203108494 * im),
        (0.047189768139734245 + 0.08031054868298411 * im),
        (0.039571353212804986 + 0.06379139284329992 * im),
        (0.03334424703769281 + 0.051027206288270795 * im),
        (0.028054314277604638 + 0.04118702961147038 * im),
        (0.02334559233531792 + 0.03340731698379901 * im),
        (0.019202769138025492 + 0.026901164349541835 * im),
        (0.015855669520376082 + 0.021252070919291963 * im),
        (0.013438303327638047 + 0.016420765249673126 * im),
        (0.011845750909636755 + 0.012475488615012893 * im),
        (0.0108471090958518 + 0.009401790207741156 * im),
        (0.010221090068789008 + 0.007091938374744601 * im),
        (0.009808397068992966 + 0.005400551185162807 * im),
        (0.009508789068639781 + 0.004187215992743545 * im),
        (0.009262901473681185 + 0.003334242971623571 * im),
        (0.00903613133123165 + 0.0027494612884949796 * im),
        (0.008807966543603864 + 0.0023629519933274627 * im),
        (0.008565734639896303 + 0.0021222699445562405 * im),
        (0.008301203119283604 + 0.0019879517131562237 * im),
        (0.008008871233775807 + 0.001929844916484826 * im),
        (0.007685233125237942 + 0.0019243168586437738 * im),
        (0.007328584124887911 + 0.0019522568765925662 * im),
        (0.006939102388158716 + 0.0019977625946940285 * im),
        (0.006519015355601383 + 0.0020474029275348716 * im),
        (0.006072698349546615 + 0.002089944227553584 * im),
        (0.005606584792724645 + 0.0021164033576885595 * im),
        (0.005128816063716731 + 0.00212026373703468 * im),
        (0.004648629384210754 + 0.0020976787000732394 * im),
        (0.00417556084652339 + 0.002047510212067948 * im),
        (0.003718601142949623 + 0.001971114488252571 * im),
        (0.003285459084897919 + 0.00187187261718373 * im),
        (0.002882055560777665 + 0.0017545432313121234 * im),
        (0.002512303779403978 + 0.0016245580367041778 * im),
        (0.002178159272216948 + 0.0014873798078793975 * im),
        (0.0018798709171629988 + 0.0013480066320623596 * im),
        (0.0016163435591121363 + 0.001210656903515785 * im),
        (0.001385529904792056 + 0.0010786263095985595 * im),
        (0.0011847923211646062 + 0.0009542811948460785 * im),
        (0.0010112017100830652 + 0.0008391431422923307 * im),
        (0.0008617627555546072 + 0.0007340226287623891 * im),
        (0.0007335694649776165 + 0.0006391690529858723 * im),
        (0.0006239024208344464 + 0.0005544153889729258 * im),
        (0.0005302814476636495 + 0.00047930530920358637 * im),
        (0.0004504866034270325 + 0.00041319773086664517 * im),
        (0.00038255819518474496 + 0.00035534833806713127 * im),
        (0.0003247839648971837 + 0.00030497020406995804 * im),
        (0.0002756792554894051 + 0.0002612767831691269 * im),
        (0.00023396407352949204 + 0.00022351079532351972 * im),
        (0.00019853954397694497 + 0.00019096228797107294 * im)
    ]

    # Correctness test
    @test resp.ρₐ ≈ get_appres.(Z_tst, ω)
    @test resp.ϕ ≈ get_phase.(Z_tst)

    # Performance test
    # alloc = @ballocated forward!(resp, m, ω)
    # @test alloc == 0
end
