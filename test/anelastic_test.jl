@testitem "anelastic tests" tags = [:anelastic] begin
    using JET
    T = collect(1073.0f0:30:1373.0f0)
    P = 2 .+ zero(T)
    dg = collect(3.0f0:4.0f-1:7.0f0)
    σ = collect(7.5f0:0.5f0:12.5f0) .* 1.0f-3
    ϕ = collect(1.0f-2:1.0f-3:2.0f-2)
    T_solidus = 1473 .+ zero(T)
    f = [1.0f0] #10f0 .^ collect(-10:1:0)
    ρ = collect(3300.0f0:100.0f0:4300.0f0)

    inps = (andrade_psp=[T, P, dg, σ, ϕ, ρ, f'],
        eburgers_psp=[T, P, dg, σ, ϕ, ρ, zero(ϕ), T_solidus, f'],
        premelt_anelastic=[T, P, dg, σ, ϕ, ρ, zero(ϕ), T_solidus, f'],
        xfit_mxw=[T, P, dg, σ, ϕ, ρ, zero(ϕ), T_solidus, f'],
        andrade_analytical=[T, P, dg, σ, ϕ, ρ, zero(ϕ), T_solidus, f'])

    methods_list = [
        andrade_psp, eburgers_psp, premelt_anelastic, xfit_mxw, andrade_analytical]

    methodsD_list = [
        andrade_pspDistribution, eburgers_pspDistribution, premelt_anelasticDistribution,
        xfit_mxwDistribution, andrade_analyticalDistribution]

    outs = (
        andrade_psp=RockphyAnelastic(
            [1.352f-11, 1.361f-11, 1.369f-11, 1.378f-11, 1.388f-11, 1.398f-11,
                1.408f-11, 1.419f-11, 1.431f-11, 1.444f-11, 1.458f-11],
            [1.40f-14, 1.89f-14, 2.51f-14, 3.30f-14, 4.29f-14, 5.51f-14,
                7.00f-14, 8.80f-14, 1.098f-13, 1.356f-13, 1.663f-13],
            [1.039f-3, 1.39f-3, 1.836f-3, 2.397f-3, 3.090f-3, 3.9398f-3,
                4.9691f-3, 6.20326f-3, 7.669f-3, 9.394f-3, 1.141f-2],
            [7.3952f10, 7.3499f10, 7.3035f10, 7.2557f10, 7.2062f10, 7.1549f10,
                7.1014f10, 7.0455f10, 6.9869f10, 6.9253f10, 6.8604f10],
            [4.7339f03, 4.6495f03, 4.5681f03, 4.4894f03, 4.4132f03, 4.3392f03,
                4.2672f03, 4.1969f03, 4.1281f03, 4.0606f03, 3.9943f03],
            [4.7339f03, 4.6495f03, 4.5681f03, 4.4894f03, 4.4132f03, 4.3392f03,
                4.2672f03, 4.1969f03, 4.1281f03, 4.0606f03, 3.9943f03]),
        eburgers_psp=RockphyAnelastic(
            [1.353f-11, 1.362f-11, 1.372f-11, 1.382f-11, 1.393f-11, 1.405f-11,
                1.417f-11, 1.430f-11, 1.443f-11, 1.458f-11, 1.473f-11],
            [3.06f-14, 3.92f-14, 4.90f-14, 6.05f-14, 7.40f-14, 8.97f-14,
                1.078f-13, 1.287f-13, 1.525f-13, 1.795f-13, 2.099f-13],
            [2.3f-3, 2.9f-3, 3.6f-3, 4.4f-3, 5.3f-3, 6.4f-3,
                7.6f-3, 9.0f-3, 1.06f-2, 1.23f-2, 1.42f-2],
            [7.3907f10, 7.3401f10, 7.2878f10, 7.2335f10, 7.1771f10, 7.1185f10,
                7.0576f10, 6.9941f10, 6.9279f10, 6.8590f10, 6.7872f10],
            [4.7325f03, 4.6464f03, 4.5631f03, 4.4825f03, 4.4043f03, 4.3282f03,
                4.2540f03, 4.1815f03, 4.1106f03, 4.0412f03, 3.9729f03],
            [4.7325f03, 4.6464f03, 4.5631f03, 4.4825f03, 4.4043f03, 4.3282f03,
                4.2540f03, 4.1815f03, 4.1106f03, 4.0412f03, 3.9729f03]),
        premelt_anelastic=RockphyAnelastic(
            [1.351f-11, 1.360f-11, 1.370f-11, 1.380f-11, 1.393f-11, 1.407f-11,
                1.423f-11, 1.442f-11, 1.464f-11, 1.491f-11, 1.576f-11],
            [1.28f-14, 2.23f-14, 3.73f-14, 5.92f-14, 8.89f-14, 1.269f-13,
                1.728f-13, 2.259f-13, 2.854f-13, 3.646f-13, 6.147f-13],
            [9.4591f-4, 1.6425f-3, 2.7f-3, 4.3f-3, 6.4f-3, 9.0f-3,
                1.21f-2, 1.57f-2, 1.95f-2, 2.44f-2, 3.90f-2],
            [7.3998f10, 7.3527f10, 7.3016f10, 7.2448f10, 7.1808f10, 7.1081f10,
                7.0256f10, 6.9328f10, 6.8299f10, 6.7042f10, 6.3399f10],
            [4.7354f03, 4.6503f03, 4.5675f03, 4.4861f03, 4.4055f03, 4.3251f03,
                4.2445f03, 4.1634f03, 4.0818f03, 3.9959f03, 3.8412f03],
            [4.7354f03, 4.6503f03, 4.5675f03, 4.4861f03, 4.4055f03, 4.3251f03,
                4.2445f03, 4.1634f03, 4.0818f03, 3.9959f03, 3.8412f03]),
        xfit_mxw=RockphyAnelastic(
            [1.412f-11, 1.432f-11, 1.453f-11, 1.475f-11, 1.498f-11, 1.522f-11,
                1.548f-11, 1.574f-11, 1.603f-11, 1.633f-11, 1.665f-11],
            [1.713f-13, 1.871f-13, 2.051f-13, 2.260f-13, 2.501f-13, 2.779f-13,
                3.102f-13, 3.476f-13, 3.909f-13, 4.410f-13, 4.991f-13],
            [0.0121, 0.0131, 0.0141, 0.0153, 0.0167, 0.0183,
                0.0200, 0.0221, 0.0244, 0.0270, 0.0300],
            [7.0802f10, 6.9807f10, 6.8797f10, 6.7773f10, 6.6733f10, 6.5676f10,
                6.4598f10, 6.3498f10, 6.2372f10, 6.1218f10, 6.0033f10],
            [4.6322f03, 4.5314f03, 4.4338f03, 4.3391f03, 4.2472f03, 4.1576f03,
                4.0702f03, 3.9848f03, 3.9009f03, 3.8185f03, 3.7373f03],
            [4.6322f03, 4.5314f03, 4.4338f03, 4.3391f03, 4.2472f03, 4.1576f03,
                4.0702f03, 3.9848f03, 3.9009f03, 3.8185f03, 3.7373f03]),
        andrade_analytical=RockphyAnelastic(
            [1.3500f-11, 1.3570f-11, 1.3650f-11, 1.3720f-11, 1.3800f-11, 1.3880f-11,
                1.3960f-11, 1.4040f-11, 1.4120f-11, 1.4200f-11, 1.4280f-11],
            [3.27f-16, 3.2999999f-16, 3.34f-16, 3.4f-16, 3.52f-16, 3.7299998f-16,
                4.1499998f-16, 4.95f-16, 6.45f-16, 9.22f-16, 1.422f-15],
            [2.4240f-5, 2.4310f-5, 2.4460f-5, 2.4780f-5, 2.5470f-5, 2.6890f-5,
                2.9720f-5, 3.5230f-5, 4.5650f-5, 6.4890f-5, 9.9510f-5],
            [7.4084f10, 7.3676f10, 7.3268f10, 7.2860f10, 7.2452f10, 7.2044f10,
                7.1636f10, 7.1228f10, 7.0820f10, 7.0412f10, 7.0004f10],
            [4.7381f03, 4.6550f03, 4.5753f03, 4.4988f03, 4.4251f03, 4.3542f03,
                4.2858f03, 4.2198f03, 4.1561f03, 4.0945f03, 4.0349f03],
            [4.7381f03, 4.6550f03, 4.5753f03, 4.4988f03, 4.4251f03, 4.3542f03,
                4.2858f03, 4.2198f03, 4.1561f03, 4.0945f03, 4.0349f03]))

    for i in eachindex(methods_list)
        m = keys(inps)[i]
        model = methods_list[i](inps[m]...)
        out_ = forward(model, [])
        @inferred forward(model, [])
        @test_opt forward(model, [])
        @test_call forward(model, [])
        for k in fieldnames(RockphyAnelastic)
            @test all(isapprox.(log10.(getfield(out_, k)), log10.(getfield(outs[m], k)), rtol=1.5f-2),)
        end
        modelD = methodsD_list[i](inps[m]...)
        @test sample_type(modelD) <: methods_list[i]
        params_ = default_params(typeof(model))
        @inferred forward(model, [], params_)
        @test_opt forward(model, [], params_)
        @test_call forward(model, [], params_)
    end
end
